# 电机统计及can/pwm接线规划
1. 3508 共9个
	1. 底盘 4           can1    1 2 3 4
	2. 秧苗 2           **can2**    1 2
	3. 发射 3           **can2**    3 4 5
2. 舵机 共2个            TIM13(PF8) 和 TIM14(PF9)
3. 气动件 共8个         两两共用，需要4个GPIO PA3~PA6
4. 航模遥控器            PF7

# 代码框架

1. 硬件底层：
	1. action 全场定位模块
	2. air_joy 航模遥控
	3. pid
	4. rm_motor 电机封装
	5. usr_can
2. 用户封装层：
	1. chassis 底盘解算
	2. config 预配置文件
	3. move 路径规划
	4. upper 上层机构
3. 状态机调用层：
	1. FSM 总状态机
	2. freertos 任务调用

# 状态分析

## 需要的任务

1. 底盘控制任务（输入：底盘速度期望；输出：硬件控制信号）
2. 秧苗控制任务（输入：秧苗状态机；输出：硬件控制信号）
3. 发射控制任务（输入：射球状态机；输出：硬件控制信号）
4. 状态机转换任务（输入：航模遥控器；输出：无）
5. 路径规划任务（输入：规划坐标；输出：底盘规划速度）


## 各个机构的状态枚举

### 整车状态
1. 初始化（状态机赋一下值，硬件初始化在main函数完成就可以）
2. 航模连接与校准
3. 自动路径运行中
4. 秧苗控制
5. 发射控制

### 底盘（四个3508）

 1. 停止
 2. 高速
 3. 低速

### 秧苗（两个3508，三个气阀）

1. 收缩（期末考核可用可不用）
2. 初始化（伸展状态）
3. 夹苗下
4. 夹苗上（上升到离地7cm左右）
5. 预备放苗（下降到离地1cm左右）
6. 放苗(13放)
各部分状态细分：

| 硬件 | 3508 | 3508 | 气阀 | 气阀 | 气阀 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 状态 | 抬升 下降0 | 翻转 上翻0 | 伸展 收缩0 | 手指1、3 松开0 | 手指2、4 松开0 |
| 1.shrink | 0 | 0 | 0 | 0 | 0 |
| 2.init | 0 | 1 | 1 | 0 | 0 |
| 3.peekdown | 0 | 1 | 1 | 1 | 1 |
| 4.peekup | 7cm | 1 | 1 | 1 | 1 |
| 5.preput | 1cm | 1 | 1 | 1 | 1 |
| 6.put | 1cm | 1 | 1 | 0 | 1 |


收缩：
	1

初始化/2,4放苗：
	2

取苗：
	2 - 3 - 4

1,3放苗：
	4 - 5 - 6


### 发射（两个舵机，两个气阀，三（两）个3508）

1. 初始化
2. 夹球
4. 发射

| 硬件 | 舵机 | 气阀 | 3508 |
| ---- | ---- | ---- | ---- |
| 状态 | 开关门 开0 | 推送 下0 | 摩擦带 停0 |
| 1.init | 0 | 0 | 0 |
| 2.load | 1 | 0 | 0 |
| 3.shoot | 1 | 1 | 1 |

初始化：
	1

取球：
	1 - 2

发射：
	2 - 3

## 航模遥控按键分配

| 按键值 | SWA | SWB | SWC | SWD |
| ---- | ---- | ---- | ---- | ---- |
| 1000 | 底盘高速 | **自适应** | 自适应 | 路径规划关 |
| 1500 | disable | 秧苗控制 | 自适应 | disable |
| 2000 | 底盘低速 | 发射控制 | 自适应 | 路径规划开 |
自动模式，根据全场定位，SWC**自适应**模式（在秧苗苗区切换为取苗模式，在射球区切换为发射模式），根据当前自动切换到的状态可以控制拨杆实现手动干预或者打断运行。

| 按键值 | SWA | SWB | SWC | SWD |
| ---- | ---- | ---- | ---- | ---- |
| 1000 | 底盘高速 | 自动模式 | **初始化**/24放苗 | 路径规划关 |
| 1500 | disable | **秧苗控制** | 取苗 | disable |
| 2000 | 底盘低速 | 发射控制 | 13放苗 | 路径规划开 |

| 按键值 | SWA | SWB | SWC | SWD |
| ---- | ---- | ---- | ---- | ---- |
| 1000 | 底盘高速 | 自动模式 | 初始状态 | 路径规划关 |
| 1500 | disable | 秧苗控制 | 夹球 | disable |
| 2000 | 底盘低速 | **发射控制** | 发射 | 路径规划开 |
右摇杆的y轴控制摩擦带转速（待定）